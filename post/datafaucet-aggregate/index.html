<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.3">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Natalino Busa">

  
  
  
    
  
  <meta name="description" content="Aggregations are an important step while processing dataframes and tabular data in general. And therefore, they should be as simple as possible to implement. Some notable data aggregation semantics are provided by pandas, spark and the SQL language.
When designing an aggregation API method, the following characteristics make in my opinion a good aggregation method.
 easily perform aggregation on a column or a set of columns easily perform multiple aggregation functions on the same columns selectively perform differently aggregations on different columns  As an nice to have to this list, it would be nice to apply aggregation functions by passing the function name as a string.">

  
  <link rel="alternate" hreflang="en-us" href="/post/datafaucet-aggregate/">

  


  
  
  
  <meta name="theme-color" content="#D70404">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/datafaucet-aggregate/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Natalino Busa">
  <meta property="og:url" content="/post/datafaucet-aggregate/">
  <meta property="og:title" content="Aggregating Dataframes | Natalino Busa">
  <meta property="og:description" content="Aggregations are an important step while processing dataframes and tabular data in general. And therefore, they should be as simple as possible to implement. Some notable data aggregation semantics are provided by pandas, spark and the SQL language.
When designing an aggregation API method, the following characteristics make in my opinion a good aggregation method.
 easily perform aggregation on a column or a set of columns easily perform multiple aggregation functions on the same columns selectively perform differently aggregations on different columns  As an nice to have to this list, it would be nice to apply aggregation functions by passing the function name as a string."><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-11-11T16:28:27&#43;08:00">
    
    <meta property="article:modified_time" content="2019-12-22T01:51:43&#43;08:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/datafaucet-aggregate/"
  },
  "headline": "Aggregating Dataframes",
  
  "datePublished": "2019-11-11T16:28:27+08:00",
  "dateModified": "2019-12-22T01:51:43+08:00",
  
  "author": {
    "@type": "Person",
    "name": "Natalino Busa"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Natalino Busa",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "Aggregations are an important step while processing dataframes and tabular data in general. And therefore, they should be as simple as possible to implement. Some notable data aggregation semantics are provided by pandas, spark and the SQL language.\nWhen designing an aggregation API method, the following characteristics make in my opinion a good aggregation method.\n easily perform aggregation on a column or a set of columns easily perform multiple aggregation functions on the same columns selectively perform differently aggregations on different columns  As an nice to have to this list, it would be nice to apply aggregation functions by passing the function name as a string."
}
</script>

  

  


  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#D70404",
          "text": "#fff"
        },
        "button": {
          "background": "#fff",
          "text": "#D70404"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "https://cookies.insites.com"
      }
    })});
</script>



  





  <title>Aggregating Dataframes | Natalino Busa</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  

<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Natalino Busa</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Natalino Busa</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#featured"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Aggregating Dataframes</h1>

  

  
    


<div class="article-metadata">

  
  
  
  
  <div>
    



  
  <span><a href="/authors/natbusa/">Natalino Busa</a></span>

  </div>
  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    2019-12-22
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    10 min read
  </span>
  

  
  
  
  <span class="middot-divider"></span>
  <a href="/post/datafaucet-aggregate/#disqus_thread"></a>
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/datafaucet/">datafaucet</a></span>
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      <p>Aggregations are an important step while processing dataframes and tabular data
in general. And therefore, they should be as simple as possible to implement.
Some notable data aggregation semantics are provided by pandas, spark and the SQL
language.</p>
<p>When designing an aggregation API method, the following characteristics make in
my opinion a good aggregation method.</p>
<ul>
<li>easily perform aggregation on a column or a set of columns</li>
<li>easily perform multiple aggregation functions on the same columns</li>
<li>selectively perform differently aggregations on different columns</li>
</ul>
<p>As an nice to have to this list, it would be nice to apply aggregation functions
by passing the function name as a string. A good aggregation method should allow
all the above with minimal amount of code required.</p>
<h2 id="getting-started">Getting started</h2>
<p>Let's start spark using datafaucet.</p>
<pre><code class="language-python">import datafaucet as dfc
</code></pre>
<pre><code class="language-python">
dfc.engine('spark')
</code></pre>
<pre><code>&lt;datafaucet.spark.engine.SparkEngine at 0x7fbdb66f2128&gt;
</code></pre>
<pre><code class="language-python">
spark  = dfc.context()
</code></pre>
<h2 id="generating-data">Generating Data</h2>
<pre><code class="language-python">df = spark.range(100)
</code></pre>
<pre><code class="language-python">df = (df
    .cols.create('g').randint(0,3)
    .cols.create('n').randchoice(['Stacy', 'Sandra'])
    .cols.create('x').randint(0,100)
    .cols.create('y').randint(0,100)
)
</code></pre>
<pre><code class="language-python">df.data.grid(5)
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>g</th>
      <th>n</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>Sandra</td>
      <td>91</td>
      <td>89</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>Sandra</td>
      <td>19</td>
      <td>57</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>Sandra</td>
      <td>34</td>
      <td>97</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>Stacy</td>
      <td>35</td>
      <td>15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>4</td>
      <td>2</td>
      <td>Sandra</td>
      <td>93</td>
      <td>90</td>
    </tr>
  </tbody>
</table>
</div>
<h2 id="pandas">Pandas</h2>
<p>Let's start by looking how Pandas does aggregations. Pandas is quite flexible on the points noted above and uses hierachical indexes on both columns and rows to store the aggregation names and the groupby values. Here below a simple aggregation and a more complex one with groupby and multiple aggregation functions.</p>
<pre><code class="language-python">pf = df.data.collect()
</code></pre>
<pre><code class="language-python">pf[['n', 'x', 'y']].agg(['max'])
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>max</td>
      <td>Stacy</td>
      <td>97</td>
      <td>98</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-python">agg = (pf[['g','n', 'x', 'y']]
           .groupby(['g', 'n'])
           .agg({
               'n': 'count',
               'x': ['min', max],
               'y':['min', 'max']
           }))
agg
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead tr th {
    text-align: left;
}

.dataframe thead tr:last-of-type th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>n</th>
      <th colspan="2" halign="left">x</th>
      <th colspan="2" halign="left">y</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>count</th>
      <th>min</th>
      <th>max</th>
      <th>min</th>
      <th>max</th>
    </tr>
    <tr>
      <th>g</th>
      <th>n</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td rowspan="2" valign="top">0</td>
      <td>Sandra</td>
      <td>9</td>
      <td>14</td>
      <td>75</td>
      <td>3</td>
      <td>98</td>
    </tr>
    <tr>
      <td>Stacy</td>
      <td>21</td>
      <td>10</td>
      <td>96</td>
      <td>8</td>
      <td>92</td>
    </tr>
    <tr>
      <td rowspan="2" valign="top">1</td>
      <td>Sandra</td>
      <td>20</td>
      <td>8</td>
      <td>91</td>
      <td>9</td>
      <td>91</td>
    </tr>
    <tr>
      <td>Stacy</td>
      <td>18</td>
      <td>2</td>
      <td>89</td>
      <td>4</td>
      <td>97</td>
    </tr>
    <tr>
      <td rowspan="2" valign="top">2</td>
      <td>Sandra</td>
      <td>12</td>
      <td>4</td>
      <td>97</td>
      <td>1</td>
      <td>98</td>
    </tr>
    <tr>
      <td>Stacy</td>
      <td>20</td>
      <td>4</td>
      <td>96</td>
      <td>0</td>
      <td>98</td>
    </tr>
  </tbody>
</table>
</div>
<h3 id="stacking">Stacking</h3>
<p>In pandas, you can stack the multiple column index and move it to a column, as below. The choice of stacking or not after aggregation depends on wht you want to do later with the data. Next to the extra index, stacking also explicitely code NaN / Nulls for evry aggregation which is not shared by each column (in case of dict of aggregation functions.</p>
<pre><code class="language-python">agg = pf[['g', 'x', 'y']].groupby(['g']).agg(['min', 'max', 'mean'])
agg = agg.stack(0)
agg
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>max</th>
      <th>mean</th>
      <th>min</th>
    </tr>
    <tr>
      <th>g</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td rowspan="2" valign="top">0</td>
      <td>x</td>
      <td>96</td>
      <td>50.966667</td>
      <td>10</td>
    </tr>
    <tr>
      <td>y</td>
      <td>98</td>
      <td>47.133333</td>
      <td>3</td>
    </tr>
    <tr>
      <td rowspan="2" valign="top">1</td>
      <td>x</td>
      <td>91</td>
      <td>45.026316</td>
      <td>2</td>
    </tr>
    <tr>
      <td>y</td>
      <td>97</td>
      <td>48.736842</td>
      <td>4</td>
    </tr>
    <tr>
      <td rowspan="2" valign="top">2</td>
      <td>x</td>
      <td>97</td>
      <td>58.750000</td>
      <td>4</td>
    </tr>
    <tr>
      <td>y</td>
      <td>98</td>
      <td>53.906250</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
<h3 id="index-as-columns">Index as columns</h3>
<p>Index in pandas is not the same as column data, but you can easily move from one to the other, as shown below, by combine the name information of the various index levels with the values of each level.</p>
<pre><code class="language-python">agg.index.names
</code></pre>
<pre><code>FrozenList(['g', None])
</code></pre>
<pre><code class="language-python">
agg.index.get_level_values(0)
</code></pre>
<pre><code>Int64Index([0, 0, 1, 1, 2, 2], dtype='int64', name='g')
</code></pre>
<p>The following script will iterate through all the levels and create a column with the name of the original index level otherwise will use <code>_&lt;level#&gt;</code> if no name is available. Remember that pandas allows indexes to be nameless.</p>
<pre><code class="language-python">levels = agg.index.names
for (name, lvl) in zip(levels, range(len(levels))):
    agg[name or f'_{lvl}'] = agg.index.get_level_values(lvl)
</code></pre>
<pre><code class="language-python">
agg.reset_index(inplace=True, drop=True)
agg
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>max</th>
      <th>mean</th>
      <th>min</th>
      <th>g</th>
      <th>_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>96</td>
      <td>50.966667</td>
      <td>10</td>
      <td>0</td>
      <td>x</td>
    </tr>
    <tr>
      <td>1</td>
      <td>98</td>
      <td>47.133333</td>
      <td>3</td>
      <td>0</td>
      <td>y</td>
    </tr>
    <tr>
      <td>2</td>
      <td>91</td>
      <td>45.026316</td>
      <td>2</td>
      <td>1</td>
      <td>x</td>
    </tr>
    <tr>
      <td>3</td>
      <td>97</td>
      <td>48.736842</td>
      <td>4</td>
      <td>1</td>
      <td>y</td>
    </tr>
    <tr>
      <td>4</td>
      <td>97</td>
      <td>58.750000</td>
      <td>4</td>
      <td>2</td>
      <td>x</td>
    </tr>
    <tr>
      <td>5</td>
      <td>98</td>
      <td>53.906250</td>
      <td>0</td>
      <td>2</td>
      <td>y</td>
    </tr>
  </tbody>
</table>
</div>
<h2 id="spark-python">Spark (Python)</h2>
<p>Spark aggregation is a bit simpler, but definitely very flexible, so we can achieve the same result with a little more work in some cases. Here below a simple example and a more complex one, reproducing the same three cases as above.</p>
<pre><code class="language-python">df.select('n', 'x', 'y').agg({'n':'max', 'x':'max', 'y':'max'}).toPandas()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>max(x)</th>
      <th>max(y)</th>
      <th>max(n)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>97</td>
      <td>98</td>
      <td>Stacy</td>
    </tr>
  </tbody>
</table>
</div>
<p>Or with a little more work we can exactly reproduce the pandas case:</p>
<pre><code class="language-python">from pyspark.sql import functions as F

df.select('n', 'x', 'y').agg(
    F.lit('max').alias('_idx'),
    F.max('n').alias('n'), 
    F.max('x').alias('x'), 
    F.max('y').alias('y')).toPandas()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_idx</th>
      <th>n</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>max</td>
      <td>Stacy</td>
      <td>97</td>
      <td>98</td>
    </tr>
  </tbody>
</table>
</div>
<p>More complicated aggregation cannot be called by string and must be provided by functions. Here below a way to reproduce groupby aggregation as in the second pandas example:</p>
<pre><code class="language-python">(df
    .select('g', 'n', 'x', 'y')
    .groupby('g', 'n')
    .agg(
        F.count('n').alias('n_count'),
        F.min('x').alias('x_min'),
        F.max('x').alias('x_max'),
        F.min('y').alias('y_min'),
        F.max('y').alias('y_max')
    )
).toPandas()
        
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>g</th>
      <th>n</th>
      <th>n_count</th>
      <th>x_min</th>
      <th>x_max</th>
      <th>y_min</th>
      <th>y_max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>Sandra</td>
      <td>10</td>
      <td>17</td>
      <td>96</td>
      <td>8</td>
      <td>98</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0</td>
      <td>Stacy</td>
      <td>20</td>
      <td>10</td>
      <td>92</td>
      <td>3</td>
      <td>86</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1</td>
      <td>Stacy</td>
      <td>18</td>
      <td>4</td>
      <td>89</td>
      <td>4</td>
      <td>97</td>
    </tr>
    <tr>
      <td>3</td>
      <td>2</td>
      <td>Sandra</td>
      <td>14</td>
      <td>29</td>
      <td>96</td>
      <td>1</td>
      <td>98</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1</td>
      <td>Sandra</td>
      <td>20</td>
      <td>2</td>
      <td>91</td>
      <td>4</td>
      <td>97</td>
    </tr>
    <tr>
      <td>5</td>
      <td>2</td>
      <td>Stacy</td>
      <td>18</td>
      <td>4</td>
      <td>97</td>
      <td>0</td>
      <td>96</td>
    </tr>
  </tbody>
</table>
</div>
<h3 id="stacking-1">Stacking</h3>
<p>Stacking, as in pandas, can be used to expose the column name on a different index column, unfortunatel stack is currently available only in the SQL initerface and not very flexible as in the pandas counterpart (<a href="https://spark.apache.org/docs/2.3.0/api/sql/#stack">https://spark.apache.org/docs/2.3.0/api/sql/#stack</a>)</p>
<p>You could use pyspark <code>expr</code> to call the SQL function as explained here (<a href="https://stackoverflow.com/questions/42465568/unpivot-in-spark-sql-pyspark)">https://stackoverflow.com/questions/42465568/unpivot-in-spark-sql-pyspark)</a>. However, another way would be to union the various results as shown here below.</p>
<pre><code class="language-python">agg = pf[['g', 'x', 'y']].groupby(['g']).agg(['min', 'max', 'mean'])
a
</code></pre>
<pre><code class="language-python">from pyspark.sql import functions as F

(df
    .select('g', 'x')
    .groupby('g')
    .agg(
        F.lit('x').alias('_idx'),
        F.min('x').alias('min'),
        F.max('x').alias('max'),
        F.mean('x').alias('mean')
    )
).union(
df
    .select('g', 'y')
    .groupby('g')
    .agg(
        F.lit('y').alias('_idx'),
        F.min('y').alias('min'),
        F.max('y').alias('max'),
        F.mean('y').alias('mean')
    )
).toPandas()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>g</th>
      <th>_idx</th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>x</td>
      <td>2</td>
      <td>91</td>
      <td>45.026316</td>
    </tr>
    <tr>
      <td>1</td>
      <td>2</td>
      <td>x</td>
      <td>4</td>
      <td>97</td>
      <td>58.750000</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0</td>
      <td>x</td>
      <td>10</td>
      <td>96</td>
      <td>50.966667</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1</td>
      <td>y</td>
      <td>4</td>
      <td>97</td>
      <td>48.736842</td>
    </tr>
    <tr>
      <td>4</td>
      <td>2</td>
      <td>y</td>
      <td>0</td>
      <td>98</td>
      <td>53.906250</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0</td>
      <td>y</td>
      <td>3</td>
      <td>98</td>
      <td>47.133333</td>
    </tr>
  </tbody>
</table>
</div>
<h3 id="generatring-aggregating-code">Generatring aggregating code</h3>
<p>The code above looks complicated, but is very regular, hence we can generate it! What we need is a to a list of lists for the aggregation functions as shown here below:</p>
<pre><code class="language-python">dfs = []
for c in ['x','y']:
    print(' '*2, f'col: {c}')
    aggs = []
    for func in [F.min, F.max, F.mean]:
        f = func(c).alias(func.__name__)
        aggs.append(f)
        print(' '*4, f'func: {f}')
        
    dfs.append(df.select('g', c).groupby('g').agg(*aggs))
</code></pre>
<pre><code>   col: x
     func: Column&lt;b'min(x) AS `min`'&gt;
     func: Column&lt;b'max(x) AS `max`'&gt;
     func: Column&lt;b'avg(x) AS `mean`'&gt;
   col: y
     func: Column&lt;b'min(y) AS `min`'&gt;
     func: Column&lt;b'max(y) AS `max`'&gt;
     func: Column&lt;b'avg(y) AS `mean`'&gt;
</code></pre>
<p>The dataframes in this generator have all the same columns and can be reduced with union calls</p>
<pre><code class="language-python">from functools import reduce

reduce(lambda a,b: a.union(b), dfs).toPandas()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>g</th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>91</td>
      <td>45.026316</td>
    </tr>
    <tr>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>97</td>
      <td>58.750000</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0</td>
      <td>10</td>
      <td>96</td>
      <td>50.966667</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1</td>
      <td>4</td>
      <td>97</td>
      <td>48.736842</td>
    </tr>
    <tr>
      <td>4</td>
      <td>2</td>
      <td>0</td>
      <td>98</td>
      <td>53.906250</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0</td>
      <td>3</td>
      <td>98</td>
      <td>47.133333</td>
    </tr>
  </tbody>
</table>
</div>
<h2 id="meet-datafaucet-agg">Meet DataFaucet agg</h2>
<p>One of the goal of datafaucet is to simplify analytics, data wrangling and data
discovery over a set of engine with an intuitive interface. So the sketched
solution above is available, with a few extras. See below the examples</p>
<p>The code here below attempt to produce readable code, engine agnostic data
aggregations. The aggregation api is always in the form:</p>
<p><code>df.cols.get(...).groupby(...).agg(...)</code></p>
<p>Alternativaly, you can <code>find</code> instead of <code>get</code></p>
<pre><code class="language-python">
d = df.cols.get('x').agg('distinct')
d.data.grid()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>64</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-python">
d = df.cols.get('x').agg(['distinct', 'avg'])
d.data.grid()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x_distinct</th>
      <th>x_avg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>64</td>
      <td>51.2</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-python">
d = df.cols.get('x').agg(['distinct', 'avg'], stack=True)
d.data.grid()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_idx</th>
      <th>distinct</th>
      <th>avg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>x</td>
      <td>64</td>
      <td>51.2</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-python">
d = df.cols.get('x').agg(['distinct', 'avg'], stack='colname')
d.data.grid()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>colname</th>
      <th>distinct</th>
      <th>avg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>x</td>
      <td>64</td>
      <td>51.2</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-python">
d = df.cols.get('x').agg(['distinct', F.min, F.max, 'avg'])
d.data.grid()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x_distinct</th>
      <th>x_min</th>
      <th>x_max</th>
      <th>x_avg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>64</td>
      <td>2</td>
      <td>97</td>
      <td>51.2</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-python">
d = df.cols.get('x', 'y').agg(['distinct', F.min, F.max, 'avg'])
d.data.grid()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x_distinct</th>
      <th>x_min</th>
      <th>x_max</th>
      <th>x_avg</th>
      <th>y_distinct</th>
      <th>y_min</th>
      <th>y_max</th>
      <th>y_avg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>64</td>
      <td>2</td>
      <td>97</td>
      <td>51.2</td>
      <td>67</td>
      <td>0</td>
      <td>98</td>
      <td>49.91</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-python">
d = df.cols.get('x', 'y').agg({
    'x':['distinct', F.min], 
    'y':['distinct', 'max']})

d.data.grid()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x_distinct</th>
      <th>x_min</th>
      <th>x_max</th>
      <th>y_distinct</th>
      <th>y_min</th>
      <th>y_max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>64</td>
      <td>2</td>
      <td>None</td>
      <td>67</td>
      <td>None</td>
      <td>98</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-python">
d = df.cols.get('x', 'y').agg({
    'x':['distinct', F.min], 
    'y':['distinct', 'max']}, stack=True)
d.data.grid()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_idx</th>
      <th>distinct</th>
      <th>min</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>x</td>
      <td>64</td>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <td>1</td>
      <td>y</td>
      <td>67</td>
      <td>NaN</td>
      <td>98.0</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-python">
d = df.cols.get('x', 'y').groupby('g','n').agg({
    'x':['distinct', F.min], 
    'y':['distinct', 'max']}, stack=True)
d.data.grid()
</code></pre>
<h3 id="extended-list-of-aggregation">Extended list of aggregation</h3>
<p>An extended list of aggregation is available, both by name and by function in the datafaucet library</p>
<pre><code class="language-python">from datafaucet.spark import aggregations as A

d = df.cols.get('x', 'y').groupby('g','n').agg([
        'type',
        ('uniq', A.distinct),
        'one',
        'top3',
    ], stack=True)

d.data.grid()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>g</th>
      <th>n</th>
      <th>_idx</th>
      <th>type</th>
      <th>uniq</th>
      <th>one</th>
      <th>top3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>Stacy</td>
      <td>x</td>
      <td>int</td>
      <td>23</td>
      <td>67</td>
      <td>{32: 2, 25: 2, 39: 2}</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0</td>
      <td>Stacy</td>
      <td>x</td>
      <td>int</td>
      <td>16</td>
      <td>74</td>
      <td>{70: 1, 74: 1, 19: 1}</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2</td>
      <td>Sandra</td>
      <td>x</td>
      <td>int</td>
      <td>10</td>
      <td>40</td>
      <td>{4: 2, 97: 2, 69: 1}</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1</td>
      <td>Sandra</td>
      <td>x</td>
      <td>int</td>
      <td>13</td>
      <td>52</td>
      <td>{56: 1, 8: 1, 2: 1}</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0</td>
      <td>Sandra</td>
      <td>x</td>
      <td>int</td>
      <td>13</td>
      <td>79</td>
      <td>{36: 2, 89: 1, 35: 1}</td>
    </tr>
    <tr>
      <td>5</td>
      <td>2</td>
      <td>Stacy</td>
      <td>x</td>
      <td>int</td>
      <td>20</td>
      <td>45</td>
      <td>{61: 1, 34: 2, 70: 1}</td>
    </tr>
    <tr>
      <td>6</td>
      <td>2</td>
      <td>Stacy</td>
      <td>y</td>
      <td>int</td>
      <td>13</td>
      <td>98</td>
      <td>{30: 2, 66: 2, 35: 2}</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0</td>
      <td>Stacy</td>
      <td>y</td>
      <td>int</td>
      <td>13</td>
      <td>57</td>
      <td>{36: 1, 57: 1, 25: 1}</td>
    </tr>
    <tr>
      <td>8</td>
      <td>1</td>
      <td>Sandra</td>
      <td>y</td>
      <td>int</td>
      <td>16</td>
      <td>79</td>
      <td>{97: 2, 82: 2, 15: 3}</td>
    </tr>
    <tr>
      <td>9</td>
      <td>2</td>
      <td>Sandra</td>
      <td>y</td>
      <td>int</td>
      <td>14</td>
      <td>40</td>
      <td>{1: 1, 98: 1, 7: 1}</td>
    </tr>
    <tr>
      <td>10</td>
      <td>1</td>
      <td>Stacy</td>
      <td>y</td>
      <td>int</td>
      <td>17</td>
      <td>76</td>
      <td>{4: 2, 86: 2, 67: 1}</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0</td>
      <td>Sandra</td>
      <td>y</td>
      <td>int</td>
      <td>15</td>
      <td>24</td>
      <td>{64: 1, 8: 1, 53: 2}</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-python">
</code></pre>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/analytics/">analytics</a>
  
  <a class="badge badge-light" href="/tags/pyspark/">pyspark</a>
  
  <a class="badge badge-light" href="/tags/pandas/">pandas</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/datafaucet-aggregate/&amp;text=Aggregating%20Dataframes" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/datafaucet-aggregate/&amp;t=Aggregating%20Dataframes" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Aggregating%20Dataframes&amp;body=/post/datafaucet-aggregate/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/datafaucet-aggregate/&amp;title=Aggregating%20Dataframes" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Aggregating%20Dataframes%20/post/datafaucet-aggregate/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/datafaucet-aggregate/&amp;title=Aggregating%20Dataframes" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  
  
    
  
  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="portrait mr-3" src="/authors/natbusa/avatar_hud7ce5ed799787d51c38a8085060478a3_837156_250x250_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Natalino Busa</a></h5>
      <h6 class="card-subtitle">Senior Director Data</h6>
      <p class="card-text">Senior Director of Data Science, AI, Big Data Technologies.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="http://www.linkedin.com/in/natbusa" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/natbusa" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/natbusa" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/natbusa/resume" target="_blank" rel="noopener">
        <i class="ai ai-cv"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>




<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  let disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "natbusa" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>






  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/streaming-analytics/">Streaming Analytics</a></li>
      
      <li><a href="/post/ai-trip/">The AI scene in the valley</a></li>
      
      <li><a href="/post/data-science-qa/">Data Science Q&amp;A</a></li>
      
      <li><a href="/post/rewind-2016/">Rewind 2016</a></li>
      
    </ul>
  </div>
  



  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.3/mermaid.min.js" integrity="" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

    

    
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    <script id="dsq-count-scr" src="https://natbusa.disqus.com/count.js" async></script>
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.600a2e440c16093e23e26e90951c4d4b.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    2019 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
